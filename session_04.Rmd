---
title: "Session 4: Data Management"
subtitle: "Learning Objectives:"
---

- Learn to recode, transform and create new useful variables.
- Learn to group and summarise data into useful bits of information.
- Learn how to report and visualize different types of data.


# Resources

## Cheatsheets

- [Data transformation](https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf)
- [Data visualization](https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf)

## Readings
- [Exploratory Data Analysis](https://r4ds.had.co.nz/exploratory-data-analysis.html)

## Practice

- [Data visualization with ggplot2](https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2)
- [Exploratory Data Analysis](https://learn.datacamp.com/courses/exploratory-data-analysis-in-r)
- [Data Cleaning](https://learn.datacamp.com/courses/cleaning-data-in-r)


# Data Management

Once we know more about our dataset, it is time to more fix the identified flaws in the data and begin to extract useful insights. We continue the explore, transform and visualize loop to learn more from the data and create useful variables also known as features. This process can easily take 80% or more of a researcher's time.

We will continue to use dplyr's verbs to manipulate the data.

- `select()` picks variables based on their names.
- `filter()` picks cases based on their values.
- `mutate()` adds new variables that are functions.
- `arrange()` changes the ordering of the rows.
- `rename()` changes the name of individual variables.

We will focus on data aggregation functions:

- `summary()` produces result summaries based on the class of the object.
- `groub_by()` group by one or more variables.
- `summarise()` summarise each group to fewer rows.

![](https://uw-madison-datascience.github.io/2019-09-11-uwmadison-dc/slides/dplyr/dplyr-4.png "")


## Types of data

We have seen that there are different types of data in R (numeric, character, factor, logical, ...). In the real world, we can group data in two broad families:

**Discrete** data can only take a finite number of values.

- eg. The number of students in a class.

**Continuous** data can take an infinite number of values.

- eg. The height of a student.

## Levels of Measurement

We can further divide each of these data types into four families:

**Nominal:** Differences of kind. There is no mathematical relationship between the values.

eg. Political parties.

**Ordinal:** Differences of degree. There is a mathematical relationships among the values. Symbols like <, ≤, =, ≥, and > have meaning but the distance between two elements is not constant.

eg. Levels of education.

**Interval:** There is a mathematical relationship among the elements and the distance between them is constant but they do not have a meaningful zero value.

eg. Feelings thermometer (0 to 100).

**Ratio:** Similar to the interval variables but they have a meaningful zero value.

eg. Feelings thermometer (-50 to 50)

We can notice that each subsequent level of measurement has the properties of levels before it. For more details on this see [Chapter 1, Siegel, 2013](https://press.princeton.edu/books/paperback/9780691159171/a-mathematics-course-for-political-and-social-research).

Understanding these variable types helps us recode the variables in our datasets into their appropriate types in order to extract proper insights or create useful features for our predictive models. To recode the variables we will often use a combination of functions such as:

- `mutate()`
- `as.numeric()`
- `as.character(`)
- `as.factor()`
- `as.logical()`

# Hack Time!

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy()
```

```{r eval=FALSE}
# Session 4: Data Management  --------------------------------------------------
# Load required libraries
library(tidyverse)

# Identify the path to the `ts_2016.rds` dataset on your machine
data_path <- "..."
data_path <- "../template/data/ts_2016.rds"

# Read your data and save it into an object called `dataset`
dataset <- ...
dataset <- readRDS(data_path)


# Let's work on a subset of the dataset with meaningful names
tmp_data <- dataset %>%
  select(
    V161031,  # vote_intent
    V161086,  # ft_democrat
    V161087,  # ft_republican
    V161126,  # ideology
    V161181,  # defense
    V161184,  # healthcare
    V161178,  # government
    V161155   # party_id
  ) %>%
  rename(
    "vote_intent"   = "V161031",
    "ft_democrat"   = "V161086",
    "ft_republican" = "V161087",
    "ideology"      = "V161126",
    "defense"       = "V161181",
    "healthcare"    = "V161184",
    "government"    = "V161178",
    "party_id"      = "V161155"
  )

# Peek at the newly created dataset
...
head(tmp_data)

# Plot the vote_intent variable
  ggplot(tmp_data, aes(x=...)) +
  geom_bar()

# Drop the missing values for vote_intent and save it into a new object
...
vote_clean <- tmp_data %>%
  select(vote_intent) %>%
  filter(vote_intent>0)

# What is the current class of this variable? And is this class appropriate?
...
class(tmp_data$vote_intent)

# Pass the newly created dataset as an argument to the `summary()` function
...
summary(tmp_data)

clean data

makes summaries

plot summaries



# Transform the code fto make a function and use it on the other variables



# Fix
  geom_text(
    aes(label=scales::percent(..prop..), y=..prop..*100), stat="count", vjust = -.5
  ) +
  ylab("Percentage (%)") +
  xlab("Candidates") +
  theme_minimal() +
  theme(legend.position="none") +
  scale_x_discrete(
    limits=c("1"="H. Clinton", "2"="D. Trump", "3"="G. Johnson", "4"="J. Stein")
  ) +
  scale_fill_brewer(limits=c("2", "1", "4", "3"), palette="Set1")
...






# What are the types of the variables in `tmp_data`

...
sapply(tmp_data, class)

# Let's fix the types
tmp_data <- tmp_data %>%
  mutate(
  ...
  )

tmp_data <- tmp_data %>%
  mutate(
    "vote_intent"   = "V161031",
    "ft_democrat"   = "V161086",
    "ft_republican" = "V161087",
    "ideology"      = "V161126",
    "defense"       = "V161181",
    "healthcare"    = "V161184",
    "government"    = "V161178",
    "party_id"      = "V161155"
  )

# Make a function to clean

# Create meaningful names for each of the 5 variables in tmp_data and save them.
...
tmp_data <- tmp_data %>%
  rename(
    vote_part  = V161005,
    age        = V161267,
    left_right = V161126,
    vote_int   = V161031,
    party_id   = V161155
  )


```


# Requirements
- Complete [Challenge 3: The Explorer](https://classroom.github.com/a/f4bspIRM)

